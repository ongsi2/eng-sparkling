# ENG-SPARKLING 프로젝트 분석 리포트

**작성일**: 2025-12-19
**분석자**: Claude Code
**프로젝트 상태**: 개발 진행 중 (MVP)

---

## 1. 프로젝트 개요

ENG-SPARKLING은 AI 기반 영어 문제 자동 생성 서비스입니다. 수능 영어 12가지 문제 유형을 GPT-4o-mini를 활용하여 자동 생성합니다.

### 기술 스택
- **Frontend**: Next.js 16+ (App Router), React 19, TypeScript, Tailwind CSS 4
- **Backend**: Next.js API Routes, Supabase (Auth, DB)
- **AI**: OpenAI API (GPT-4o-mini)
- **결제**: Toss Payments SDK

---

## 2. 현재 구현된 기능

### 2.1 인증 시스템
| 기능 | 상태 | 파일 |
|------|------|------|
| Google OAuth | ✅ 완료 | `app/components/AuthProvider.tsx` |
| GitHub OAuth | ✅ 완료 | `lib/supabase.ts` |
| 세션 관리 | ✅ 완료 | `app/auth/callback/route.ts` |

### 2.2 코인 시스템
| 기능 | 상태 | 파일 |
|------|------|------|
| DB 기반 코인 관리 | ✅ 완료 | `lib/coins.ts` |
| 코인 차감/추가 | ✅ 완료 | `lib/coins.ts:48-96` |
| 코인 표시 UI | ✅ 완료 | `app/components/CoinDisplay.tsx` |

### 2.3 문제 생성
| 기능 | 상태 | 파일 |
|------|------|------|
| 12가지 문제 유형 | ✅ 완료 | `lib/all-prompts.ts` |
| AI 문제 생성 API | ✅ 완료 | `app/api/generate/route.ts` |
| 아티클 생성 API | ✅ 완료 | `app/api/generate-article/route.ts` |
| 마커 빌드 로직 | ✅ 완료 | `app/api/generate/route.ts:45-147` |

### 2.4 결제 시스템
| 기능 | 상태 | 파일 |
|------|------|------|
| Toss Payments 연동 | ✅ 완료 | `app/payment/page.tsx` |
| 주문 생성 | ✅ 완료 | `app/api/payment/create-order/route.ts` |
| 결제 확인 | ✅ 완료 | `app/api/payment/confirm/route.ts` |

### 2.5 관리자 대시보드
| 기능 | 상태 | 파일 |
|------|------|------|
| 통계 대시보드 | ✅ 완료 | `app/admin/page.tsx` |
| 유저 관리 | ✅ 완료 | `app/admin/users/page.tsx` |
| 결제 내역 | ✅ 완료 | `app/admin/orders/page.tsx` |
| 생성 로그 | ✅ 완료 | `app/admin/logs/page.tsx` |

### 2.6 데모 시스템
| 기능 | 상태 | 파일 |
|------|------|------|
| IP 기반 사용량 추적 | ✅ 완료 | `lib/demo.ts` |
| 2회 무료 제한 | ✅ 완료 | `lib/demo.ts:9` |
| 데모 상태 API | ✅ 완료 | `app/api/demo/status/route.ts` |

---

## 3. 테스트 결과

### 3.1 개발 서버 테스트
- **서버 시작**: ✅ 정상 (HTTP 200)
- **메인 페이지**: ✅ 정상 로드
- **Workflow 페이지**: ✅ 데모 모드 정상 작동
- **데모 카운터**: ✅ 2회 남음 표시 확인

### 3.2 UI/UX 확인
- 반응형 디자인: ✅ 모바일/데스크톱 분기 처리됨
- 로딩 스켈레톤: ✅ 구현됨 (`app/components/Skeleton.tsx`)
- 에러 바운더리: ✅ 구현됨 (`app/components/ErrorBoundary.tsx`)
- Toast 알림: ✅ react-hot-toast 적용됨

---

## 4. 개선 권장 사항

### 4.1 보안 개선 (우선순위: 높음)

#### 4.1.1 Rate Limiting 강화
현재 `lib/rate-limit.ts`에 기본 rate limiting이 있지만, 더 강화 필요:
```typescript
// 현재: 메모리 기반 → 권장: Redis 기반으로 변경
// 서버 재시작 시 rate limit이 초기화되는 문제
```

#### 4.1.2 환경변수 검증
```typescript
// lib/env.ts에서 환경변수 검증을 하고 있으나
// 런타임에서 누락 시 명확한 에러 메시지 필요
if (!process.env.OPENAI_API_KEY) {
  throw new Error('OPENAI_API_KEY is required');
}
```

#### 4.1.3 API 인증 강화
- 관리자 API에 추가 검증 레이어 권장
- JWT 토큰 만료 시간 검증 추가

### 4.2 성능 개선 (우선순위: 중간)

#### 4.2.1 문제 생성 병렬화
현재 `app/workflow/page.tsx:263-302`에서 순차 처리:
```typescript
// 현재: 순차 생성
for (const type of selectedQuestionTypes) {
  const response = await fetch(...);
}

// 권장: 병렬 생성 (단, rate limit 고려)
const results = await Promise.allSettled(
  selectedQuestionTypes.map(type => fetch(...))
);
```

#### 4.2.2 캐싱 전략
- 생성된 아티클 캐싱 (동일 키워드 재사용)
- 데모 문제 캐싱 (CDN 활용 가능)

### 4.3 코드 품질 (우선순위: 중간)

#### 4.3.1 타입 일관성
`types/index.ts`에 정의된 타입과 실제 사용 타입 불일치 일부 존재:
- `QuestionType`가 `types/index.ts`와 `app/workflow/page.tsx`에 중복 정의됨

#### 4.3.2 컴포넌트 분리
`app/workflow/page.tsx`가 1190줄로 너무 큼:
- Step1Article 컴포넌트 분리 권장
- Step2Question 컴포넌트 분리 권장
- QuestionCard 컴포넌트 분리 권장

#### 4.3.3 SparklingLogo 중복
`SparklingLogo` 컴포넌트가 여러 파일에 중복:
- `app/page.tsx`
- `app/workflow/page.tsx`
- `app/payment/page.tsx`
→ 공통 컴포넌트로 추출 권장

### 4.4 기능 추가 (우선순위: 낮음)

#### 4.4.1 URL에서 아티클 가져오기
HANDOFF.md에 TODO로 기록됨:
```typescript
// app/api/fetch-url/route.ts 존재하나 UI 연동 필요
```

#### 4.4.2 PDF 내보내기 개선
- 현재: html2canvas + jsPDF 조합
- 권장: 서버사이드 PDF 생성 (품질 향상)

#### 4.4.3 문제 공유 기능
- 생성된 문제 링크 공유
- QR 코드 생성

---

## 5. 잠재적 버그/이슈

### 5.1 코인 차감 타이밍
`app/workflow/page.tsx:291-294`:
```typescript
// 문제 생성 성공 후 코인 차감
// 문제: 여러 문제 생성 중 일부 실패 시 이미 차감된 코인 환불 로직 없음
if (user) {
  await deductCoinsFromDB(user.id, COIN_COSTS.GENERATE_QUESTION);
}
```

### 5.2 데모 사용량 동기화
데모 사용량 증가와 실제 생성이 별도 트랜잭션:
```typescript
// lib/demo.ts:79-132
// 문제 생성 실패해도 사용량은 증가할 수 있음
```

### 5.3 Footer 저작권 연도
`app/page.tsx:569`:
```typescript
// 2024로 하드코딩됨 → 동적으로 변경 권장
<p>© 2024 ENG-SPARKLING...</p>
```

---

## 6. 추가할 스킬/에이전트 제안

### 6.1 문제 검증 스킬 (`/validate-question`)
생성된 문제의 품질 검증:
- 정답이 실제로 맞는지 확인
- 선지 중복 확인
- 문법 오류 검사

### 6.2 난이도 분석 스킬 (`/analyze-difficulty`)
- 어휘 수준 분석
- 문장 복잡도 분석
- 예상 정답률 추정

### 6.3 유사 문제 생성 스킬 (`/similar-question`)
기존 문제를 기반으로 유사한 문제 생성

---

## 7. 다음 단계 권장

### 즉시 수정 (버그/이슈)
1. [ ] 코인 환불 로직 추가
2. [ ] Footer 연도 동적 처리
3. [ ] 타입 중복 정의 통합

### 단기 개선 (1-2주)
1. [ ] SparklingLogo 공통 컴포넌트화
2. [ ] workflow 페이지 컴포넌트 분리
3. [ ] URL 아티클 가져오기 UI 연동

### 중기 개선 (1개월)
1. [ ] Redis 기반 Rate Limiting
2. [ ] 문제 생성 병렬화
3. [ ] 문제 검증 스킬 개발

---

## 8. 요약

ENG-SPARKLING은 MVP로서 핵심 기능이 잘 구현되어 있습니다. 특히:
- 12가지 문제 유형별 정교한 프롬프트
- Supabase 기반 인증/DB 연동
- Toss Payments 결제 시스템
- IP 기반 데모 시스템

개선이 필요한 부분:
- 대규모 코드 파일 분리 (workflow 1190줄)
- 중복 컴포넌트 통합 (SparklingLogo 등)
- 트랜잭션 처리 강화 (코인 차감/환불)

전반적으로 프로덕션 배포 전 위 개선사항을 반영하면 안정적인 서비스 운영이 가능할 것으로 보입니다.
